#!/usr/bin/make -f

export DEB_BUILD_MAINT_OPTIONS = hardening=+all
DPKG_EXPORT_BUILDFLAGS = 1
include /usr/share/dpkg/default.mk

CFLAGS  += -g -O2 -fno-strict-aliasing -fno-strict-overflow -fPIC
LDFLAGS += -g -O2 -fno-strict-aliasing -fno-strict-overflow -fPIC -Wl,-z,defs -Wl,--as-needed

%:
	dh $@ --with systemd

override_dh_auto_configure:

override_dh_auto_build:
	autoreconf;                                         \
	CFLAGS="$(CFLAGS)" LDFLAGS="$(LDFLAGS)" ./configure \
		--prefix=/usr                                     \
		--sysconfdir=/etc/bird                            \
		--mandir=\$${prefix}/share/man                    \
		--infodir=\$${prefix}/share/info                  \
		--localstatedir=/var                              \
		--with-runtimedir=/run/bird                       \
		--enable-client;                                  \
	make

override_dh_installinit:
	dh_installinit --name=bird --restart-after-upgrade

override_dh_clean:
	make clean;     \
	make distclean; \
	true

override_dh_auto_install:

override_dh_auto_clean:

override_dh_auto_test:

override_dh_builddeb:
	dh_builddeb -- -Zgzip
